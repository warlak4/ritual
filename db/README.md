# База данных «Ритуаль»

Репозиторий содержит полный комплект SQL-скриптов для развёртывания, обслуживания и тестирования базы данных Microsoft SQL Server, используемой системой «Ритуаль».

## Структура каталога

- `scripts/00_prerequisites.sql` — создание базы данных, ключей шифрования, вспомогательных схем.
- `scripts/01_tables.sql` — определение таблиц, первичных и внешних ключей, ограничений целостности.
- `scripts/02_views.sql` — представления для отчётности и удобочитаемых выборок.
- `scripts/03_security.sql` — роли БД, пользователи, гранты, политики маскирования.
- `scripts/04_programmability.sql` — хранимые процедуры, функции и транзакционные сценарии.
- `scripts/05_triggers.sql` — триггеры для аудита, шифрования и валидации.
- `scripts/06_seed.sql` — начальные данные и тестовые наборы.
- `scripts/07_backup.sql` — регламент резервного копирования (FULL/DIFF/LOG).
- `scripts/08_restore.sql` — сценарий восстановления на стенд.
- `scripts/09_testcases.sql` — вспомогательные запросы для автоматизированных тестов.

Дополнительно в подкаталоге `migrations/` генерируются миграции TypeORM (см. backend).

## Порядок запуска

1. Выполнить `00_prerequisites.sql` для создания базы данных `RitualDB`, симметричных ключей шифрования и пользователей.
2. Выполнить `01_tables.sql`, затем `02_views.sql`, `03_security.sql`, `04_programmability.sql`, `05_triggers.sql`.
3. Загрузить начальные данные `06_seed.sql`.
4. Подключить регламент резервного копирования (`07_backup.sql`) и протестировать восстановление (`08_restore.sql`).

Все скрипты рассчитаны на выполнение в SSMS либо через `sqlcmd` внутри контейнера (см. `ops/docker-compose.yml`).

